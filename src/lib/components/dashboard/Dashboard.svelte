<script lang="ts">
	import { capitalize } from 'ts-utils/text';
	import { onMount, type Snippet } from 'svelte';
	import MinimizedCards from './MinimizedCards.svelte';
	import { browser } from '$app/environment';
	import { Dashboard } from '$lib/model/dashboard';

	interface Props {
		body: Snippet;
		dashboard: Dashboard.Dashboard;
	}

	const { body, dashboard }: Props = $props();

	// let gridSize = $state(12);
	let resizeTimeout: number | undefined;

	const updateGridSize = () => {
		if (!browser) return;
		let gridSize = 0;
		if (resizeTimeout) cancelAnimationFrame(resizeTimeout);
		resizeTimeout = requestAnimationFrame(() => {
			gridSize = Dashboard.sizes[Dashboard.getGridSize()];

			document.documentElement.style.setProperty('--grid-size', String(gridSize));
		});
	};

	updateGridSize();
	onMount(() => {
		window.addEventListener('resize', updateGridSize);
		return () => window.removeEventListener('resize', updateGridSize);
	});
</script>

<div>
	<h1>{capitalize(dashboard.name)}</h1>
	<MinimizedCards {dashboard} />
	<div
		style="
		display: grid; 
		grid-template-columns: repeat(var(--grid-size), 1fr);
		gap: 10px;
	"
		class="p-3"
	>
		{@render body()}
	</div>
</div>

<style>
	:root {
		--grid-size: 12;
	}
</style>
